/*
 * Encog(tm) Core v0.1 - Javascript Version
 * http://www.heatonresearch.com/encog/
 * http://code.google.com/p/encog-java/

 * Copyright 2008-2012 Heaton Research, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *   
 * For more information on Heaton Research copyrights, licenses 
 * and trademarks visit:
 * http://www.heatonresearch.com/copyright
 */

var ENCOG=ENCOG||{VERSION:"1.0",PLATFORM:"javascript",precision:1e-10,NEWLINE:"\n",ENCOG_TYPE_ACTIVATION:"ActivationFunction",ENCOG_TYPE_RBF:"RBF"};ENCOG.namespace=function(e){var t=e.split("."),n=window,r="",i,s;for(i=0,s=t.length;i<s;i+=1)r=t[i],n[r]=n[r]||{},n=n[r];return n},ENCOG.namespace("ENCOG.ActivationSigmoid"),ENCOG.namespace("ENCOG.ActivationTANH"),ENCOG.namespace("ENCOG.ActivationLinear"),ENCOG.namespace("ENCOG.ActivationElliott"),ENCOG.namespace("ENCOG.ActivationElliottSymmetric"),ENCOG.namespace("ENCOG.RadialGaussian"),ENCOG.namespace("ENCOG.RadialMexicanHat"),ENCOG.namespace("ENCOG.Util"),ENCOG.namespace("ENCOG.MathUtil"),ENCOG.namespace("ENCOG.ArrayUtil"),ENCOG.namespace("ENCOG.BasicLayer"),ENCOG.namespace("ENCOG.BasicNetwork"),ENCOG.namespace("ENCOG.PropagationTrainer"),ENCOG.namespace("ENCOG.LinearErrorFunction"),ENCOG.namespace("ENCOG.LinearErrorFunction"),ENCOG.namespace("ENCOG.Swarm"),ENCOG.namespace("ENCOG.Anneal"),ENCOG.namespace("ENCOG.Genetic"),ENCOG.namespace("ENCOG.SOM"),ENCOG.namespace("ENCOG.TrainSOM"),ENCOG.namespace("ENCOG.ReadCSV"),ENCOG.namespace("ENCOG.EGFILE"),ENCOG.MathUtil=function(){},ENCOG.MathUtil.tanh=function(e){var t,n;return t=Math.exp(e),n=Math.exp(-e),(t-n)/(t+n)},ENCOG.MathUtil.sign=function(e){return Math.abs(e)<ENCOG.precision?0:e>0?1:-1},ENCOG.MathUtil.euclideanDistance=function(e,t,n,r){var i=0,s,o;for(s=n;s<n+r;s+=1)o=e[s]-t[s],i+=o*o;return Math.sqrt(i)},ENCOG.MathUtil.kNearest=function(e,t,n,r,i,s){var o=[],u=[],a=0,f=-1,l,c;while(a<t.length)c=t[a],e!==c&&(l=ENCOG.MathUtil.euclideanDistance(e,c,i,s),l<r&&(o.length<n?(o.push(c),u.push(l),f=ENCOG.ArrayUtil.arrayMaxIndex(u)):l<u[f]&&(u[f]=l,o[f]=c,f=ENCOG.ArrayUtil.arrayMaxIndex(u)))),a+=1;return o},ENCOG.MathUtil.randomFloat=function(e,t){return Math.random*(t-e)+e},ENCOG.ArrayUtil=function(){},ENCOG.ArrayUtil.fillArray=function(e,t,n,r){var i;for(i=t;i<n;i+=1)e[i]=r},ENCOG.ArrayUtil.newFloatArray=function(e){var t;t=[];while(e>0)t.push(0),e-=1;return t},ENCOG.ArrayUtil.newIntArray=function(e){var t;t=[];while((e-=1)>0)t.push(0);return t},ENCOG.ArrayUtil.fillArray2D=function(e,t){var n,r,i;for(n=0;n<e.length;n+=1){i=e[n];for(r=0;r<i.length;r+=1)i[r]=t}},ENCOG.ArrayUtil.randomizeArray=function(e,t,n,r,i){var s;for(s=t;s<n;s+=1)e[s]=ENCOG.MathUtil.randomFloat(r,i)},ENCOG.ArrayUtil.randomizeArray2D=function(e,t,n){var r,i,s;for(r=0;r<e.length;r+=1){s=e[r];for(i=0;i<s.length;i+=1)s[i]=ENCOG.MathUtil.randomFloat(t,n)}},ENCOG.ArrayUtil.allocate1D=function(e){var t,n;n=[];for(t=0;t<e;t+=1)n[t]=0;return n},ENCOG.ArrayUtil.allocateBoolean2D=function(e,t){var n,r,i,s;n=[[]];for(r=0;r<e;r+=1){s=[];for(i=0;i<t;i+=1)s[i]=!1;n[r]=s}return n},ENCOG.ArrayUtil.arrayCopy=function(e,t,n,r,i){var s;for(s=0;s<i;s+=1)n[s+r]=e[s+t]},ENCOG.ArrayUtil.generateBenchmarkData=function(e,t){var n,r,i,s;n=[[]];for(i=0;i<e;i+=1){r=[];for(s=0;s<t;s+=1)r[s]=Math.random()*2-1;n[i]=r}return n},ENCOG.ArrayUtil.arrayMean=function(e,t){var n,r;n=0;for(r=0;r<e.length;r+=1)n+=e[r][t];return n/=e.length,n},ENCOG.ArrayUtil.arrayMinIndex=function(e){var t,n,r;t=Number.MAX_VALUE,n=-1;for(r=0;r<e.length;r+=1)e[r]<t&&(t=e[r],n=r);return n},ENCOG.ArrayUtil.arrayMaxIndex=function(e){var t,n,r;t=Number.MIN_VALUE,n=-1;for(r=0;r<e.length;r+=1)e[r]>t&&(t=e[r],n=r);return n},ENCOG.Util.stripQuotes=function(e){var t=e.length;if(e[0]==='"'||e[0]==="'")e=e.substr(1),t-=1;if(e[t-1]==='"'||e[t-1]==="'")e=e.substr(0,t-1);return e},ENCOG.ActivationSigmoid=function(){},ENCOG.ActivationSigmoid.prototype={NAME:"ActivationSigmoid",encogType:ENCOG.ENCOG_TYPE_ACTIVATION,activationFunction:function(e,t,n){var r;for(r=t;r<t+n;r+=1)e[r]=1/(1+Math.exp(-1*e[r]))},derivativeFunction:function(e,t){return t*(1-t)}},ENCOG.ActivationSigmoid.create=function(){return new ENCOG.ActivationSigmoid},ENCOG.ActivationTANH=function(){},ENCOG.ActivationTANH.prototype={NAME:"ActivationTANH",encogType:ENCOG.ENCOG_TYPE_ACTIVATION,activationFunction:function(e,t,n){var r;for(r=t;r<t+n;r+=1)e[r]=ENCOG.MathUtil.tanh(e[r])},derivativeFunction:function(e,t){return 1-t*t}},ENCOG.ActivationTANH.create=function(){return new ENCOG.ActivationTANH},ENCOG.ActivationLinear=function(){},ENCOG.ActivationLinear.prototype={NAME:"ActivationLinear",encogType:ENCOG.ENCOG_TYPE_ACTIVATION,activationFunction:function(){},derivativeFunction:function(){return 1}},ENCOG.ActivationLinear.create=function(){return new ENCOG.ActivationLinear},ENCOG.ActivationElliott=function(){},ENCOG.ActivationElliott.prototype={NAME:"ActivationElliott",encogType:ENCOG.ENCOG_TYPE_ACTIVATION,slope:1,activationFunction:function(e,t,n){var r;for(r=t;r<t+n;r+=1)e[r]=e[r]*this.slope/2/(1+Math.abs(e[r]*this.slope))+.5},derivativeFunction:function(e,t){return this.slope/(2*(1+Math.abs(e*this.slope))*(1+Math.abs(e*this.slope)))}},ENCOG.ActivationElliott.create=function(e){var t=new ENCOG.ActivationElliott;return t.slope=e||1,t},ENCOG.ActivationElliottSymmetric=function(){},ENCOG.ActivationElliottSymmetric.prototype={NAME:"ActivationElliottSymmetric",encogType:ENCOG.ENCOG_TYPE_ACTIVATION,slope:1,activationFunction:function(e,t,n){var r;for(r=t;r<t+n;r+=1)e[r]=e[r]*this.slope/(1+Math.abs(e[r]*this.slope))},derivativeFunction:function(e,t){var n=1+Math.abs(e*this.slope);return this.slope/(n*n)}},ENCOG.ActivationElliottSymmetric.create=function(e){var t=new ENCOG.ActivationElliottSymmetric;return t.slope=e||1,t},ENCOG.RadialGaussian=function(){},ENCOG.RadialGaussian.prototype={NAME:"RadialGaussian",encogType:ENCOG.ENCOG_TYPE_RBF,center:[],width:1,peak:1,calculate:function(e){var t=0,n;for(n=0;n<this.center.length;n+=1)t+=Math.pow(e[n]-this.center[n],2)/(2*this.width*this.width);return this.peak*Math.exp(-t)}},ENCOG.RadialGaussian.create=function(e,t,n){var r=new ENCOG.RadialGaussian;return r.peak=e||1,r.centers=t,r.width=n||1,r},ENCOG.RadialMexicanHat=function(){},ENCOG.RadialMexicanHat.prototype={NAME:"RadialMexicanHat",encogType:ENCOG.ENCOG_TYPE_RBF,center:[],width:[],peak:1,calculate:function(e){var t=0,n;for(n=0;n<this.center.length;n+=1)t+=Math.pow(e[n]-this.center[n],2);return this.peak*(1-t)*Math.exp(-t/2)}},ENCOG.RadialMexicanHat.create=function(e,t,n){var r=new ENCOG.RadialMexicanHat;return r.peak=e||1,r.centers=t,r.width=n||1,r},ENCOG.LinearErrorFunction=function(){},ENCOG.LinearErrorFunction.prototype={calculateError:function(e,t,n){var r;for(r=0;r<t.length;r+=1)n[r]=e[r]-t[r]}},ENCOG.LinearErrorFunction.create=function(){return new ENCOG.LinearErrorFunction},ENCOG.BasicLayer=function(){},ENCOG.BasicLayer.prototype={NAME:"BasicLayer",activation:null,count:null,biasActivation:null,contextFedBy:null,calcTotalCount:function(){return this.contextFedBy===null?this.count+(this.hasBias()?1:0):this.count+(this.hasBias()?1:0)+this.contextFedBy.count},hasBias:function(){return Math.abs(this.biasActivation)>ENCOG.precision},calcContextCount:function(){return this.contextFedBy===null?0:this.contextFedBy.count}},ENCOG.BasicLayer.create=function(e,t,n){var r;if(e.encogType!==ENCOG.ENCOG_TYPE_ACTIVATION)throw new Error("Invalid activation function.");return r=new ENCOG.BasicLayer,r.activation=e,r.count=t,r.biasActivation=n,r.contextFedBy=null,r},ENCOG.BasicNetwork=function(){},ENCOG.BasicNetwork.prototype={NAME:"BasicNetwork",inputCount:null,outputCount:null,layerCounts:null,layerContextCount:null,weightIndex:null,layerIndex:null,activationFunctions:null,layerFeedCounts:null,contextTargetOffset:null,contextTargetSize:null,biasActivation:null,beginTraining:null,endTraining:null,weights:null,layerOutput:null,layerSums:null,connectionLimit:ENCOG.precision,clearContext:function(){var e,t,n;e=0;for(t=0;t<this.layerIndex.length;t+=1)n=this.layerContextCount[t]+this.layerFeedCounts[t]!==this.layerCounts[t],ENCOG.ArrayUtil.fillArray(this.layerOutput,e,e+this.layerFeedCounts[t],0),e+=this.layerFeedCounts[t],n&&(this.layerOutput[e]=this.biasActivation[t],e+=1),ENCOG.ArrayUtil.fillArray(this.layerOutput,e,e+this.layerContextCount[t],0),e+=this.layerContextCount[t]},randomize:function(){var e;for(e=0;e<this.weights.length;e+=1)this.weights[e]=Math.random()*2-1},computeLayer:function(e){var t,n,r,i,s,o,u,a,f,l,c;t=this.layerIndex[e],n=this.layerIndex[e-1],r=this.layerCounts[e],i=this.layerFeedCounts[e-1],s=this.weightIndex[e-1],o=n+i,u=t+r;for(a=n;a<o;a+=1){f=0;for(c=t;c<u;c+=1)f+=this.weights[s]*this.layerOutput[c],s+=1;this.layerSums[a]=f,this.layerOutput[a]=f}this.activationFunctions[e-1].activationFunction(this.layerOutput,n,i),l=this.contextTargetOffset[e],ENCOG.ArrayUtil.arrayCopy(this.layerOutput,n,this.layerOutput,l,this.contextTargetSize[e])},compute:function(e,t){var n,r,i;n=this.layerOutput.length-this.layerCounts[this.layerCounts.length-1],ENCOG.ArrayUtil.arrayCopy(e,0,this.layerOutput,n,this.inputCount);for(r=this.layerIndex.length-1;r>0;r-=1)this.computeLayer(r);i=this.contextTargetOffset[0],ENCOG.ArrayUtil.arrayCopy(this.layerOutput,0,this.layerOutput,i,this.contextTargetSize[0]),ENCOG.ArrayUtil.arrayCopy(this.layerOutput,0,t,0,this.outputCount)},evaluate:function(e,t){var n,r,i,s,o,u,a,f;o=[],a=0,f=0;for(n=0;n<e.length;n+=1){i=e[n],s=t[n],this.compute(i,o);for(r=0;r<s.length;r+=1)u=s[r]-o[r],a+=u*u,f+=1}return a/f}},ENCOG.BasicNetwork.create=function(e){var t,n,r,i,s,o,u,a,f,l;n=new ENCOG.BasicNetwork;if(e!=null){t=e.length,n.inputCount=e[0].count,n.outputCount=e[t-1].count,n.layerCounts=ENCOG.ArrayUtil.allocate1D(t),n.layerContextCount=ENCOG.ArrayUtil.allocate1D(t),n.weightIndex=ENCOG.ArrayUtil.allocate1D(t),n.layerIndex=ENCOG.ArrayUtil.allocate1D(t),n.activationFunctions=ENCOG.ArrayUtil.allocate1D(t),n.layerFeedCounts=ENCOG.ArrayUtil.allocate1D(t),n.contextTargetOffset=ENCOG.ArrayUtil.allocate1D(t),n.contextTargetSize=ENCOG.ArrayUtil.allocate1D(t),n.biasActivation=ENCOG.ArrayUtil.allocate1D(t),r=0,i=0,s=0;for(o=e.length-1;o>=0;o-=1){a=e[o],f=null,o>0&&(f=e[o-1]),n.biasActivation[r]=a.biasActivation,n.layerCounts[r]=a.calcTotalCount(),n.layerFeedCounts[r]=a.count,n.layerContextCount[r]=a.calcContextCount(),n.activationFunctions[r]=a.activation,i+=a.calcTotalCount(),f!==null&&(s+=a.count*f.calcTotalCount()),r===0?(n.weightIndex[r]=0,n.layerIndex[r]=0):(n.weightIndex[r]=n.weightIndex[r-1]+n.layerCounts[r]*n.layerFeedCounts[r-1],n.layerIndex[r]=n.layerIndex[r-1]+n.layerCounts[r-1]),l=0;for(u=e.length-1;u>=0;u-=1)e[u].contextFedBy===a&&(n.hasContext=!0,n.contextTargetSize[r]=e[u].calcContextCount(),n.contextTargetOffset[r]=l+(e[u].calcTotalCount()-e[u].calcContextCount())),l+=e[u].calcTotalCount();r+=1}n.beginTraining=0,n.endTraining=n.layerCounts.length-1,n.weights=ENCOG.ArrayUtil.allocate1D(s),n.layerOutput=ENCOG.ArrayUtil.allocate1D(i),n.layerSums=ENCOG.ArrayUtil.allocate1D(i),n.clearContext()}return n},ENCOG.PropagationTrainer=function(){},ENCOG.PropagationTrainer.prototype={NAME:"PropagationTrainer",POSITIVE_ETA:1.2,NEGATIVE_ETA:.5,DELTA_MIN:1e-6,MAX_STEP:50,network:null,trainingInput:null,trainingIdeal:null,type:null,learningRate:null,momentum:null,layerDelta:null,gradients:null,lastGradient:null,lastDelta:null,actual:null,flatSpot:null,errorFunction:ENCOG.LinearErrorFunction.create(),updateValues:null,processLevel:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;n=this.network.layerIndex[e+1],t=this.network.layerIndex[e],i=this.network.layerCounts[e+1],s=this.network.layerFeedCounts[e],r=this.network.weightIndex[e],o=this.network.activationFunctions[e+1],u=this.flatSpot[e+1],a=n;for(p=0;p<i;p+=1){f=this.network.layerOutput[a],l=0,c=t,h=r+p;for(d=0;d<s;d+=1)this.gradients[h]+=f*this.layerDelta[c],l+=this.network.weights[h]*this.layerDelta[c],h+=i,c+=1;this.layerDelta[a]=l*(o.derivativeFunction(this.network.layerSums[a],this.network.layerOutput[a])+u),a+=1}},learnBPROP:function(){var e,t;for(e=0;e<this.network.weights.length;e+=1)t=this.gradients[e]*this.learningRate+this.lastDelta[e]*this.momentum,this.lastDelta[e]=t,this.network.weights[e]+=t},learnRPROP:function(){var e,t,n,r;for(r=0;r<this.network.weights.length;r+=1)t=ENCOG.MathUtil.sign(this.gradients[r]*this.lastGradient[r]),n=0,t>0?(e=this.updateValues[r]*this.POSITIVE_ETA,e=Math.min(e,this.MAX_STEP),n=ENCOG.MathUtil.sign(this.gradients[r])*e,this.updateValues[r]=e,this.lastGradient[r]=this.gradients[r]):t<0?(e=this.updateValues[r]*this.NEGATIVE_ETA,e=Math.max(e,this.DELTA_MIN),this.updateValues[r]=e,n=-this.lastDelta[r],this.lastGradient[r]=0):t===0&&(e=this.updateValues[r],n=ENCOG.MathUtil.sign(this.gradients[r])*e,this.lastGradient[r]=this.gradients[r]),this.network.weights[r]+=n},process:function(e,t,n){var r,i,s;this.network.compute(e,this.actual);for(i=0;i<t.length;i+=1)s=this.actual[i]-t[i],this.globalError=this.globalError+s*s,this.setSize+=1;this.errorFunction.calculateError(t,this.actual,this.layerDelta);for(r=0;r<this.actual.length;r+=1)this.layerDelta[r]=(this.network.activationFunctions[0].derivativeFunction(this.network.layerSums[r],this.network.layerOutput[r])+this.flatSpot[0])*this.layerDelta[r]*n;for(r=this.network.beginTraining;r<this.network.endTraining;r+=1)this.processLevel(r)},iteration:function(){var e;this.globalError=0,this.setSize=0,this.actual=[],ENCOG.ArrayUtil.fillArray(this.gradients,0,this.gradients.length,0),ENCOG.ArrayUtil.fillArray(this.lastDelta,0,this.lastDelta.length,0);for(e=0;e<this.trainingInput.length;e+=1)this.process(this.trainingInput[e],this.trainingIdeal[e],1);this.type==="BPROP"?this.learnBPROP():this.type==="RPROP"&&this.learnRPROP(),this.error=this.globalError/this.setSize}},ENCOG.PropagationTrainer.create=function(e,t,n,r,i,s){var o=new ENCOG.PropagationTrainer;return o.network=e,o.trainingInput=t,o.trainingIdeal=n,o.type=r,o.learningRate=i,o.momentum=s,o.layerDelta=ENCOG.ArrayUtil.newFloatArray(e.layerOutput.length),o.gradients=ENCOG.ArrayUtil.newFloatArray(e.weights.length),o.lastGradient=ENCOG.ArrayUtil.newFloatArray(e.weights.length),o.lastDelta=ENCOG.ArrayUtil.newFloatArray(e.weights.length),o.actual=ENCOG.ArrayUtil.newFloatArray(e.outputCount),o.flatSpot=ENCOG.ArrayUtil.newFloatArray(e.layerOutput.length),o.updateValues=ENCOG.ArrayUtil.newFloatArray(e.weights.length),ENCOG.ArrayUtil.fillArray(o.lastGradient,0,o.lastGradient.length,0),ENCOG.ArrayUtil.fillArray(o.updateValues,0,o.updateValues.length,.1),ENCOG.ArrayUtil.fillArray(o.flatSpot,0,e.weights.length,0),o},ENCOG.Swarm=function(){},ENCOG.Swarm.prototype={NAME:"Swarm",agents:null,callbackNeighbors:null,constCohesion:.01,constAlignment:.5,constSeparation:.25,iteration:function(){var e,t,n,r,i,s,o,u,a,f,l,c;for(e=0;e<this.agents.length;e+=1)o=0,t=ENCOG.MathUtil.kNearest(this.agents[e],this.agents,5,Number.MAX_VALUE,0,2),u=ENCOG.MathUtil.kNearest(this.agents[e],this.agents,5,10,0,2),a=0,u.length>0&&(n=ENCOG.ArrayUtil.arrayMean(u,0),r=ENCOG.ArrayUtil.arrayMean(u,1),i=n-this.agents[e][0],s=r-this.agents[e][1],a=Math.atan2(i,s)*180/Math.PI-this.agents[e][2],a+=180),f=0,t.length>0&&(f=ENCOG.ArrayUtil.arrayMean(t,2)-this.agents[e][2]),this.callbackNeighbors!==null&&this.callbackNeighbors(e,t),l=0,t.length>0&&(n=ENCOG.ArrayUtil.arrayMean(this.agents,0),r=ENCOG.ArrayUtil.arrayMean(this.agents,1),i=n-this.agents[e][0],s=r-this.agents[e][1],l=Math.atan2(i,s)*180/Math.PI-this.agents[e][2]),c=l*this.constCohesion+f*this.constAlignment+a*this.constSeparation,this.agents[e][2]+=c}},ENCOG.Swarm.create=function(e){var t=new ENCOG.Swarm;return t.agents=e,t},ENCOG.Anneal=function(){},ENCOG.Anneal.prototype={NAME:"Anneal",solution:null,scoreSolution:null,randomize:null,constStartTemp:10,constStopTemp:2,constCycles:10,iteration:function(){var e,t,n,r,i;e=this.solution.slice(),t=this.constStartTemp,n=this.scoreSolution(this.solution);for(i=0;i<this.constCycles;i+=1)this.randomize(this.solution,t),r=this.scoreSolution(this.solution),r<n&&(e=this.solution.slice(),n=r),this.solution=e.slice(),t*=Math.exp(Math.log(this.constStopTemp/this.constStartTemp)/(this.constCycles-1))}},ENCOG.Anneal.create=function(e){var t=new ENCOG.Anneal;return t.solution=e,t},ENCOG.Genetic=function(){},ENCOG.Genetic.prototype={NAME:"Genetic",population:null,scoreSolution:null,mutate:null,crossover:null,constMutationPercent:.1,constMatePercent:.24,constMatingPopulationPercent:.5,iteration:function(){var e,t,n,r,i,s;e=Math.floor(this.population.length*this.constMatePercent),t=e*2,n=this.population.length-t,r=Math.floor(this.population.length*this.constMatingPopulationPercent);for(i=0;i<e;i++)s=Math.floor(Math.random()*r),this.crossover(this.population[i].data,this.population[s].data,this.population[n].data,this.population[n+1].data),Math.random()>this.constMutationPercent&&this.mutate(this.population[n].data),Math.random()>this.constMutationPercent&&this.mutate(this.population[n].data),this.population[n].score=this.scoreSolution(this.population[n].data),this.population[n+1].score=this.scoreSolution(this.population[n+1].data),n+=2;this.sortPopulation()},createPopulation:function(e,t){var n,r,i;this.population=[];for(n=0;n<e;n++)r=t(),i=this.scoreSolution(r),this.population[n]={data:r,score:i};this.sortPopulation()},getSolution:function(){return this.population[0].data},sortPopulation:function(){this.population.sort(function(e,t){return e.score-t.score})}},ENCOG.Genetic.create=function(){return new ENCOG.Genetic},ENCOG.SOM=function(){},ENCOG.SOM.prototype={NAME:"SOM",weights:null,inputCount:0,outputCount:0,classify:function(e){var t,n,r,i;if(e.length>this.inputCount)throw new Error("Can't classify SOM with input size of "+this.inputCount+" with input data of count "+e.length);t=Number.POSITIVE_INFINITY,n=-1;for(r=0;r<this.outputCount;r+=1)i=ENCOG.MathUtil.euclideanDistance(e,this.weights[r],0,this.inputCount),i<t&&(t=i,n=r);return n}},ENCOG.SOM.create=function(e,t){var n=new ENCOG.SOM;return n.inputCount=e,n.outputCount=t,n.weights=ENCOG.ArrayUtil.allocateBoolean2D(t,e),n},ENCOG.TrainSOM=function(){},ENCOG.TrainSOM.prototype={NAME:"SOM",weights:null,som:null,learningRate:.5,correctionMatrix:null,trainingInput:null,worstDistance:0,iteration:function(){var e,t,n;ENCOG.ArrayUtil.fillArray2D(this.correctionMatrix,0);for(e=0;e<this.trainingInput.length;e++)t=this.trainingInput[e],n=this.calculateBMU(t),this.train(n,t),this.applyCorrection()},reset:function(){ENCOG.MathUtil.randomizeArray2D(this.weights,-1,1)},calculateBMU:function(e){var t,n,r,i;t=0;if(e.length>this.som.inputCount)throw new Error("Can't train SOM with input size of "+this.inputCount+" with input data of count "+e.length);n=Number.POSITIVE_INFINITY;for(r=0;r<this.som.outputCount;r++)i=ENCOG.MathUtil.euclideanDistance(this.som.weights[r],e,0,this.som.weights[r].length),i<n&&(n=i,t=r);return n>this.worstDistance&&(this.worstDistance=n),t},train:function(e,t){},applyCorrection:function(){}},ENCOG.TrainSOM.create=function(e,t){var n=new ENCOG.TrainSOM;return n.som=e,n.learningRate=t,n.correctionMatrix=ENCOG.ArrayUtil.allocateBoolean2D(this.som.outputCount,this.som.inputCount),n},ENCOG.ReadCSV=function(){},ENCOG.ReadCSV.prototype={regStr:null,inputData:null,idealData:null,inputCount:0,idealCount:0,delimiter:",",readCSV:function(e,t,n){var r,i,s,o,u;this.inputCount=t,this.idealCount=n,i=new RegExp(this.regStr,"gi"),this.inputData=[[]],this.idealData=[[]],r=0;while(s=i.exec(e))u=s[1],u.length&&u!=this.delimiter&&(this.inputData.push([]),this.idealData.push([]),r=0),s[2]?o=s[2].replace(new RegExp('""',"g"),'"'):o=s[3],r<this.inputCount?this.inputData[this.inputData.length-1].push(o):this.idealData[this.idealData.length-1].push(o),r+=1}},ENCOG.ReadCSV.create=function(e){var t=new ENCOG.ReadCSV;return t.delimiter=e||",",t.regStr="(\\"+t.delimiter+"|\\r?\\n|\\r|^)"+'(?:"([^"]*(?:""[^"]*)*)"|'+'([^"\\'+t.delimiter+"\\r\\n]*))",t},ENCOG.ReadCSV.fromCommaListInt=function(e){var t,n,r;t=[],n=e.split(",");for(r=0;r<n.length;r+=1)t.push(parseInt(n[r],10));return t},ENCOG.ReadCSV.fromCommaListFloat=function(e){var t,n,r;t=[],n=e.split(",");for(r=0;r<n.length;r+=1)t.push(parseFloat(n[r]));return t},ENCOG.ReadCSV.toCommaList=function(e){var t,n;t="";for(n=0;n<e.length;n+=1)n>0&&(t+=","),t+=e[n];return t},ENCOG.EGFILE=function(){},ENCOG.EGFILE.save=function(e){var t="",n,r,i;n=(new Date).getTime(),t+="encog,BasicNetwork,"+ENCOG.PLATFORM+",3.1.0,1,"+n+ENCOG.NEWLINE,t+="[BASIC]"+ENCOG.NEWLINE,t+="[BASIC:PARAMS]"+ENCOG.NEWLINE,t+="[BASIC:NETWORK]"+ENCOG.NEWLINE,t+="beginTraining="+e.beginTraining+ENCOG.NEWLINE,t+="connectionLimit="+e.connectionLimit+ENCOG.NEWLINE,t+="contextTargetOffset="+ENCOG.ReadCSV.toCommaList(e.contextTargetOffset)+ENCOG.NEWLINE,t+="contextTargetSize="+ENCOG.ReadCSV.toCommaList(e.contextTargetSize)+ENCOG.NEWLINE,t+="endTraining="+e.endTraining+ENCOG.NEWLINE,t+="hasContext="+(e.hasContext?"t":"f")+ENCOG.NEWLINE,t+="inputCount="+e.inputCount+ENCOG.NEWLINE,t+="layerCounts="+ENCOG.ReadCSV.toCommaList(e.layerCounts)+ENCOG.NEWLINE,t+="layerFeedCounts="+ENCOG.ReadCSV.toCommaList(e.layerFeedCounts)+ENCOG.NEWLINE,t+="layerContextCount="+ENCOG.ReadCSV.toCommaList(e.layerContextCount)+ENCOG.NEWLINE,t+="layerIndex="+ENCOG.ReadCSV.toCommaList(e.layerIndex)+ENCOG.NEWLINE,t+="output="+ENCOG.ReadCSV.toCommaList(e.layerOutput)+ENCOG.NEWLINE,t+="outputCount="+e.outputCount+ENCOG.NEWLINE,t+="weightIndex="+ENCOG.ReadCSV.toCommaList(e.weightIndex)+ENCOG.NEWLINE,t+="weights="+ENCOG.ReadCSV.toCommaList(e.weights)+ENCOG.NEWLINE,t+="biasActivation="+ENCOG.ReadCSV.toCommaList(e.biasActivation)+ENCOG.NEWLINE,t+="[BASIC:ACTIVATION]"+ENCOG.NEWLINE;for(r=0;r<e.activationFunctions.length;r+=1)i=e.activationFunctions[r],t+='"',t+=i.NAME,t+='"'+ENCOG.NEWLINE;return t},ENCOG.EGFILE.load=function(e){var t,n,r;n=0,t=e.match(/^.*([\n\r]+|$)/gm);while(t[n].trim().length===0)n+=1;r=t[n].trim().split(",");if(r[0]!=="encog")throw new Error("Not a valid Encog EG file.");if(r[1]==="BasicNetwork")return ENCOG.EGFILE.loadBasicNetwork(e);throw new Error("Encog Javascript does not support: "+r[1])},ENCOG.EGFILE._loadNetwork=function(e,t,n){var r,i,s,o;while(t<e.length){i=e[t].trim();if(i[0]=="[")break;t++,r=i.indexOf("=");if(r==-1)throw new Error("Invalid line in BasicNetwork file: "+i);s=i.substr(0,r).trim().toLowerCase(),o=i.substr(r+1).trim(),s=="begintraining"?n.beginTraining=parseInt(o):s=="connectionlimit"?n.connectionLimit=parseFloat(o):s=="contexttargetoffset"?n.contextTargetOffset=ENCOG.ReadCSV.fromCommaListInt(o):s=="contexttargetsize"?n.contextTargetSize=ENCOG.ReadCSV.fromCommaListInt(o):s=="endtraining"?n.endTraining=parseInt(o):s=="hascontext"?n.hasContext=o.toLowerCase()=="f":s=="inputcount"?n.inputCount=parseInt(o):s=="layercounts"?n.layerCounts=ENCOG.ReadCSV.fromCommaListInt(o):s=="layerfeedcounts"?n.layerFeedCounts=ENCOG.ReadCSV.fromCommaListInt(o):s=="layercontextcount"?n.layerContextCount=ENCOG.ReadCSV.fromCommaListInt(o):s=="layerindex"?n.layerIndex=ENCOG.ReadCSV.fromCommaListInt(o):s=="output"?n.layerOutput=ENCOG.ReadCSV.fromCommaListFloat(o):s=="outputcount"?n.outputCount=parseInt(o):s=="weightindex"?n.weightIndex=ENCOG.ReadCSV.fromCommaListInt(o):s=="weights"?n.weights=ENCOG.ReadCSV.fromCommaListFloat(o):s=="biasactivation"&&(n.biasActivation=ENCOG.ReadCSV.fromCommaListFloat(o))}return n.layerSums=[],ENCOG.ArrayUtil.fillArray(n.layerSums,0,n.layerSums,0),t},ENCOG.EGFILE._loadActivation=function(e,t,n){var r,i;n.activationFunctions=[],r=0;while(t<e.length){i=e[t++].trim();if(i[0]=="[")break;i=ENCOG.Util.stripQuotes(i),i=="ActivationLinear"?n.activationFunctions[r]=ENCOG.ActivationLinear.create():i=="ActivationSigmoid"?n.activationFunctions[r]=ENCOG.ActivationSigmoid.create():i=="ActivationTANH"?n.activationFunctions[r]=ENCOG.ActivationTANH.create():i=="ActivationElliott"?n.activationFunctions[r]=ENCOG.ActivationElliott.create():i=="ActivationElliottSymmetric"&&(n.activationFunctions[r]=ENCOG.ActivationElliottSymmetric.create()),r+=1}return t},ENCOG.EGFILE.loadBasicNetwork=function(e){var t,n,r,i,s;n=0,t=e.match(/^.*([\n\r]+|$)/gm);while(t[n].trim().length==0)n++;i=t[n++].trim().split(",");if(i[0]!="encog")throw new Error("Not a valid Encog EG file.");if(i[1]!="BasicNetwork")throw new Error("Not a BasicNetwork EG file.");s=new ENCOG.BasicNetwork;while(n<t.length)r=t[n++].trim(),r=="[BASIC:NETWORK]"?n=this._loadNetwork(t,n,s):r=="[BASIC:ACTIVATION]"&&(n=this._loadActivation(t,n,s));return s};