define(["text!../../templates/entity.html"],function(e){var t,n,r,i,s=Backbone.View.extend({currentPt:{row:0,col:0},currentPos:{row:0,col:0},entityTemp:_.template(e),initialize:function(e){this.model=e.model,t=e.ga,n=e.mapgrid},events:{"click #aplayer":"playSound"},currentCord:function(){var e={};return e.x=Math.floor((this.box.offset().left-this.$el.offset().left)/n.gridsize),e.y=Math.floor((this.box.offset().top-this.$el.offset().top)/n.gridsize),this.currentPos},movePath:function(e,n){this.stop=!1;var r,i;this.currentPt={row:this.currentPos.row,col:this.currentPos.col};if(e.length>3)t.startover(e),i=t.run();else{if(!(e.length>1))return n(null,e),this;i=e}var s=this;r=0;var o=function u(e){if(e.length<1)return this;var t=e.shift();s.moveTo(t.col,t.row,function(r){if(r)return s;t&&n(t),u(e)})};o(_.clone(i))},moveTo:function(e,t,r){function l(){if(f.stop)return r(!0),f;if(u.length==0)return r(!1),f;i=u.shift(),s=f.box.offset().left,o=f.box.offset().top;var e={left:i[0]*a,top:i[1]*a};f.box.animate(e,200,"linear",l),f.currentPos={row:i[1],col:i[0]}}var i,s,o,u=n.finder.findPath(this.currentPt.col,this.currentPt.row,e,t,n.grid.clone()),a=n.gridsize,f=this;u.length>0&&(this.currentPt={col:e,row:t}),l()},render:function(){return this.$el.html(this.entityTemp(this.model.toJSON())),this.box=this.$el.find("#aplayer").css({left:0,top:0,position:"absolute"}),this},playSound:function(e){e.preventDefault,document.getElementById("playerSound").play()},leaveGame:function(){this.box.fadeOut()},overGame:function(){this.box.fadeIn()}});return s});