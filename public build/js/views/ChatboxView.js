define(["text!../../templates/chatbox.html","chatroom"],function(e,t){var n=Backbone.View.extend({tagName:"div",chatbox:_.template(e),initialize:function(){this.listenTo(this.model,"change",this.render),this.loadSockets();var e=this;setTimeout(function(){console.log("timeout"),e.model.get("userid")<=1e3&&console.log("no id"),t.socket.send("newUser")},2e3)},loadSockets:function(){var e=this;t.socket.on("answer",function(t){console.log(t);var n=e.model.get("text")?e.model.get("text"):"";e.model.set("text",n+t.userId+":"+t.answer+"\n");var r=$("#answer-textbox");r.scrollTop(r[0].scrollHeight-r.height()),console.log(r[0].scrollHeight)}),t.socket.on("userId",function(t){console.log("socket on userid"),e.model.set("userId",t.userId),console.log(t)}),t.socket.on("userCt",function(t){e.model.set("userCt",t.userCt)})},events:{"click button":"sendMsg","submit form":"sendMsg"},render:function(){var e=this;return this.$el.html(this.chatbox(this.model.toJSON())),this},sendMsg:function(e){e.preventDefault();var n=$("#answer").val();n&&(t.socket.emit("answer",{userId:this.model.get("userId"),answer:n}),$("#answer").val(""))}});return n});